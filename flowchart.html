<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Crop Disease Detection - System Flowchart</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        min-height: 100vh;
      }
      .container {
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
      }
      h1 {
        color: #2c3e50;
        text-align: center;
        border-bottom: 3px solid #3498db;
        padding-bottom: 10px;
      }
      h2 {
        color: #27ae60;
        margin-top: 40px;
      }
      .mermaid {
        text-align: center;
        margin: 20px 0;
      }
      .description {
        background: #ecf0f1;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
        border-left: 5px solid #3498db;
      }
      .feature-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }
      .feature-card {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        border-left: 4px solid #e74c3c;
      }
      .feature-card h4 {
        margin: 0 0 10px 0;
        color: #2c3e50;
      }
      .legend {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin: 20px 0;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 8px;
      }
      .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .legend-color {
        width: 20px;
        height: 20px;
        border-radius: 4px;
        border: 2px solid #333;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üå± Crop Disease Detection Assistant - System Flowchart</h1>

      <div class="description">
        <h3>üìã System Overview</h3>
        <p>
          This flowchart illustrates the complete functionality of the Crop
          Disease Detection Assistant, showing how users interact with the
          system, how AI models process images, and how the Q&A system provides
          intelligent responses.
        </p>
      </div>

      <div class="feature-list">
        <div class="feature-card">
          <h4>üñºÔ∏è Image Analysis</h4>
          <p>Upload ‚Üí AI Detection ‚Üí Disease Classification</p>
        </div>
        <div class="feature-card">
          <h4>üí¨ Q&A System</h4>
          <p>Questions ‚Üí AI Processing ‚Üí Expert Answers</p>
        </div>
        <div class="feature-card">
          <h4>üåê Multi-language</h4>
          <p>English ‚Üî Bengali Translation</p>
        </div>
        <div class="feature-card">
          <h4>üîß Fallback System</h4>
          <p>Works even without OpenAI API</p>
        </div>
      </div>

      <div class="legend">
        <div class="legend-item">
          <div class="legend-color" style="background: #e1f5fe"></div>
          <span>User Actions</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #f3e5f5"></div>
          <span>Processing</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #e8f5e8"></div>
          <span>AI Models</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #fff3e0"></div>
          <span>Decisions</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #ffebee"></div>
          <span>Errors</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #e0f2f1"></div>
          <span>Success</span>
        </div>
      </div>
    </div>

    <div class="container">
      <h2>üîÑ Complete User Journey Flow</h2>
      <div class="mermaid">
        flowchart TD %% User Interface Layer A[üë§ User Opens App] --> B{üñºÔ∏è
        Upload Image?} %% Image Upload Flow B -->|Yes| C[üì§ Select/Drag Image] B
        -->|No| D[üìñ View Documentation] C --> E{üîç Valid Image?} E -->|No| F[‚ùå
        Show Error Message] E -->|Yes| G[üåê Send to Backend API] %% Backend
        Processing G --> H[üèóÔ∏è Backend Receives Image] H --> I[ü§ñ Load ML Models]
        %% Model Processing I --> J[üì∑ Image Preprocessing] J --> K[üß† SwinV2
        Disease Detection] J --> L[üí¨ BLIP Image Captioning] J --> M[üî§ ViT-GPT2
        Captioning] %% Results Processing K --> N[üè∑Ô∏è Crop & Disease
        Classification] L --> O[üìù Generate Caption 1] M --> P[üìù Generate
        Caption 2] N --> Q[üîÑ Merge Results] O --> Q P --> Q Q --> R{üåç Language
        = Bengali?} R -->|Yes| S[üîÑ Translate Results] R -->|No| T[üìä Return
        Analysis Results] S --> T %% Frontend Display T --> U[‚úÖ Display Results
        on Frontend] U --> V[üì± Show: Caption, Crop, Disease] %% Q&A Flow V -->
        W{‚ùì User Asks Question?} W -->|No| X[‚è≥ Wait for User Action] W
        -->|Yes| Y[üí≠ Process Question] Y --> Z{üîë OpenAI Key Available?} Z
        -->|Yes| AA[üß† Send to OpenAI GPT] Z -->|No| BB[üîß Use Fallback
        Responses] AA --> CC[ü§ñ Generate AI Response] BB --> DD[üìö Pattern-based
        Response] CC --> EE{üåç Bengali Response?} DD --> EE EE -->|Yes| FF[üîÑ
        Translate Answer] EE -->|No| GG[üìù Return Answer] FF --> GG GG --> HH[üí¨
        Display Answer] HH --> II[üìù Add to Chat History] %% Language Switching
        II --> JJ{üåê Switch Language?} JJ -->|Yes| KK[üîÑ Translate Everything]
        JJ -->|No| LL[üîÑ Continue Interaction] KK --> MM{üîë OpenAI Available?}
        MM -->|Yes| NN[ü§ñ Translate via GPT] MM -->|No| OO[üìã Return Original
        Text] NN --> PP[üåç Update Interface] OO --> PP PP --> LL %% Loop Back LL
        --> W X --> B F --> B D --> B %% Error Handling G -.->|Network Error|
        QQ[‚ö†Ô∏è Connection Error] H -.->|Processing Error| RR[‚ö†Ô∏è Backend Error] AA
        -.->|API Error| SS[‚ö†Ô∏è OpenAI Error ‚Üí Fallback] QQ --> F RR --> F SS -->
        BB %% Styling classDef userAction
        fill:#e1f5fe,stroke:#01579b,stroke-width:2px classDef processing
        fill:#f3e5f5,stroke:#4a148c,stroke-width:2px classDef aiModel
        fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px classDef decision
        fill:#fff3e0,stroke:#e65100,stroke-width:2px classDef error
        fill:#ffebee,stroke:#c62828,stroke-width:2px classDef success
        fill:#e0f2f1,stroke:#00695c,stroke-width:2px class A,C,Y userAction
        class H,I,J,Q,S,KK processing class K,L,M,AA,BB aiModel class
        B,E,R,W,Z,EE,JJ,MM decision class F,QQ,RR,SS error class U,V,HH,II,PP
        success
      </div>
    </div>

    <div class="container">
      <h2>üèóÔ∏è System Architecture</h2>
      <div class="mermaid">
        graph TB subgraph "üñ•Ô∏è Frontend (React + Vite)" A1[üì± User Interface]
        A2[üñºÔ∏è Image Upload Component] A3[üí¨ Q&A Component] A4[üìä Results
        Display] A5[üåê Language Selector] end subgraph "üîå API Layer" B1[üì° HTTP
        Requests] B2[üîÑ CORS Middleware] B3[üìù Request Validation] end subgraph
        "‚öôÔ∏è Backend (FastAPI)" C1[üõ£Ô∏è Route Handlers] C2[üìã Business Logic] C3[üîß
        Service Layer] end subgraph "üß† AI/ML Services" D1[ü§ñ Model Loader]
        D2[üåæ SwinV2 Disease Detection] D3[üì∑ BLIP Captioning] D4[üî§ ViT-GPT2
        Captioning] D5[üß† OpenAI GPT Service] end subgraph "üíæ Data Processing"
        E1[üñºÔ∏è Image Preprocessing] E2[üìù Text Processing] E3[üîÑ Translation
        Service] E4[üìö Fallback Responses] end subgraph "üìÅ Model Files" F1[üè∑Ô∏è
        config.json] F2[‚öñÔ∏è model.safetensors] F3[üîß preprocessor_config.json]
        end %% Connections A1 --> A2 A1 --> A3 A1 --> A4 A1 --> A5 A2 --> B1 A3
        --> B1 A5 --> B1 B1 --> B2 B2 --> B3 B3 --> C1 C1 --> C2 C2 --> C3 C3
        --> D1 C3 --> D5 D1 --> D2 D1 --> D3 D1 --> D4 D2 --> E1 D3 --> E1 D4
        --> E1 D5 --> E2 E2 --> E3 C3 --> E4 D2 --> F1 D2 --> F2 D2 --> F3 %%
        Styling classDef frontend fill:#e3f2fd,stroke:#1976d2 classDef api
        fill:#f3e5f5,stroke:#7b1fa2 classDef backend fill:#e8f5e8,stroke:#388e3c
        classDef ai fill:#fff3e0,stroke:#f57c00 classDef data
        fill:#fce4ec,stroke:#c2185b classDef files fill:#f1f8e9,stroke:#689f38
        class A1,A2,A3,A4,A5 frontend class B1,B2,B3 api class C1,C2,C3 backend
        class D1,D2,D3,D4,D5 ai class E1,E2,E3,E4 data class F1,F2,F3 files
      </div>
    </div>

    <div class="container">
      <h2>üîÑ Data Flow Sequence</h2>
      <div class="mermaid">
        sequenceDiagram participant U as üë§ User participant FE as üñ•Ô∏è Frontend
        participant API as üîå API participant BE as ‚öôÔ∏è Backend participant ML as
        üß† ML Models participant GPT as ü§ñ OpenAI Note over U,GPT: Image
        Analysis Flow U->>FE: Upload Image FE->>API: POST /diagnose/ (image)
        API->>BE: Process Request BE->>ML: Load Models ML->>ML: Preprocess Image
        ML->>ML: SwinV2 Prediction ML->>ML: BLIP Captioning ML->>BE: Return
        Results BE->>API: Analysis Response API->>FE: JSON Response FE->>U:
        Display Results Note over U,GPT: Q&A Flow U->>FE: Ask Question FE->>API:
        POST /ask/ (question) API->>BE: Process Question alt OpenAI Available
        BE->>GPT: Send Question + Context GPT->>BE: AI Response else Fallback
        Mode BE->>BE: Generate Fallback Response end BE->>API: Answer Response
        API->>FE: JSON Response FE->>U: Display Answer Note over U,GPT:
        Translation Flow U->>FE: Switch Language FE->>API: POST /translate/
        (text) API->>BE: Translation Request alt OpenAI Available BE->>GPT:
        Translate Text GPT->>BE: Translated Text else Fallback Mode BE->>BE:
        Return Original Text end BE->>API: Translation Response API->>FE:
        Updated Content FE->>U: Show Translated Interface
      </div>
    </div>

    <div class="container">
      <h2>üìä Key Components Breakdown</h2>

      <div class="feature-list">
        <div class="feature-card">
          <h4>üß† AI Models</h4>
          <ul>
            <li><strong>SwinV2:</strong> Disease detection (88 classes)</li>
            <li><strong>BLIP:</strong> Image captioning</li>
            <li><strong>ViT-GPT2:</strong> Alternative captioning</li>
            <li><strong>OpenAI GPT:</strong> Q&A and translation</li>
          </ul>
        </div>

        <div class="feature-card">
          <h4>üîß Backend Services</h4>
          <ul>
            <li><strong>FastAPI:</strong> RESTful API server</li>
            <li><strong>Model Loader:</strong> AI model management</li>
            <li><strong>Prediction Service:</strong> Image analysis</li>
            <li><strong>OpenAI Service:</strong> Q&A and translation</li>
          </ul>
        </div>

        <div class="feature-card">
          <h4>üñ•Ô∏è Frontend Components</h4>
          <ul>
            <li><strong>ImageUpload:</strong> Drag & drop interface</li>
            <li><strong>ModelResult:</strong> Analysis display</li>
            <li><strong>QuestionForm:</strong> Q&A interface</li>
            <li><strong>History:</strong> Chat history</li>
          </ul>
        </div>

        <div class="feature-card">
          <h4>üîÑ Data Flow</h4>
          <ul>
            <li><strong>Upload:</strong> Image ‚Üí Backend</li>
            <li><strong>Processing:</strong> AI ‚Üí Results</li>
            <li><strong>Display:</strong> Results ‚Üí Frontend</li>
            <li><strong>Interaction:</strong> Q&A Loop</li>
          </ul>
        </div>
      </div>
    </div>

    <script>
      mermaid.initialize({
        startOnLoad: true,
        theme: "default",
        flowchart: {
          useMaxWidth: true,
          htmlLabels: true,
          curve: "basis",
        },
        sequence: {
          diagramMarginX: 50,
          diagramMarginY: 10,
          actorMargin: 50,
          width: 150,
          height: 65,
          boxMargin: 10,
          boxTextMargin: 5,
          noteMargin: 10,
          messageMargin: 35,
        },
      });
    </script>
  </body>
</html>
